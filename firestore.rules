rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // appState/collectiveMood: Publicly readable, writeable by authenticated users.
    match /appState/collectiveMood {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // moodSnapshots: Publicly readable for the history page chart and trend analysis.
    // Writes are handled by the client-side archiving service for this project.
    match /moodSnapshots/{snapshotId} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update, delete: if false; // Prevent modification of historical data.
    }

    // communityQuotes: Publicly readable for the thoughts page.
    // Authenticated users can create new quotes.
    match /communityQuotes/{quoteId} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update, delete: if false; // Users cannot modify or delete others' quotes.
    }

    // userActivity: Users can only update their own activity document.
    match /userActivity/{userId} {
      allow read, update, create, delete: if request.auth != null && request.auth.uid == userId;
    }
  }
}
