
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Publicly readable, but only backend can write.
    // This allows clients to listen for real-time mood updates.
    match /appState/collectiveMood {
      allow read: if true;
      allow write: if false; // Protect this document from client-side writes.
    }

    // Historical snapshots are publicly readable for the history chart.
    match /moodSnapshots/{snapshotId} {
      allow read: if true;
      allow write: if false; // Only backend can create snapshots.
    }
    
    // Community quotes can be read by anyone.
    // Writes are handled by backend functions (submit) and transactions (likes).
    match /communityQuotes/{quoteId} {
      allow read: if true;
      // Allow creation/updates from authenticated users.
      // A more robust system would use backend validation.
      allow write: if request.auth != null; 
    }

    // Users can write their own activity heartbeat.
    match /userActivity/{userId} {
      allow read, write: if request.auth.uid == userId;
    }

    // A user's personal mood history is private to them.
    match /userMoodHistory/{userId}/{documents=**} {
      allow read, write: if request.auth.uid == userId;
    }
  }
}
